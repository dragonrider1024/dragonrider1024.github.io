<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
<title>Some useful python and bash scripts for computational chemistry</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="A website for Tech and Life">
<link href="/assets/css/bootstrap.min.css" rel="stylesheet">
<link href="/assets/css/styles.css" rel="stylesheet">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif] d-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-47234019-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-47234019-2');
</script>
    
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script src="/assets/js/mysite.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  </head>
  <body>
  	<div class="wrapper">
  	<div id="sidebar-wrapper">
<nav class="sidebar-nav">
	<div class="active">
		<ul>
		
			<li>
			<a href="/" >
				Home
			</a>
			</li>
		
			<li>
			<a href="/research.html" >
				Research
			</a>
			</li>
		
			<li>
			<a href="/blog.html" >
				Blog
			</a>
			</li>
		
			<li>
			<a href="/projects.html" >
				Projects
			</a>
			</li>
		
			<li>
			<a href="/about.html" >
				About
			</a>
			</li>
		
		<hr />
    	<div id="social-wrapper">
      		<li> <a href="http://twitter.com"><i class="fa fa-twitter-square"></i> @twitter</a></li>
      		<li> <a href="https://www.linkedin.com/in/wxutamu/"><i class="fa fa-linkedin-square"></i> linkedin</a> </li>
      		<li> <a href="http://facebook.com"><i class="fa fa-facebook-square"></i> facebook</a></li>
      		<li> <a href="https://github.com/dragonrider1024"><i class="fa fa-github-square"></i> github</a> </li>
      		<li> <a href="mailto:xuzhiwen1024@gmail.com"><i class="fa fa-envelope"></i> email</a></li>
    	</div>
		</ul>
	</div>
</nav>
</div>
    <div class="content">
      <button type="button" id="sidebarCollapse" class="navbar-btn">
      <span></span>
      <span></span>
      <span></span>
      </button>
      <hr/>
  		<div class="container">
    	 <h1> Some useful python and bash scripts for computational chemistry </h1>
<p>Chemistry has evloved from “beaker and test tube” age for a long time. Paul Dirac once said</p>
<blockquote class="text-justify">
  <p>The underlying physical laws necessary for the mathematical theory of a large part of physics and the <strong>whole of chemistry</strong> are thus <strong>completely known</strong>, and the difficulty is only that the exact application of these laws leads to equations much too complicated to be soluble. It therefore becomes desirable that <strong>approximate</strong> practical methods of applying quantum mechanics should be developed, which can lead to an explanation of the main features of complex atomic systems without too much computation.</p>
</blockquote>

<p>Computational chemistry has been a very powerful and useful tool started from the last century due to the advances in computing power.</p>

<p>Below are three useful python or bash scripts written to calculate ion-molecule reaction rates, ion-molecule collision cross sections, and electron impact ionization cross sections based on information extracted from quantum chemistry calculations.
<!--more--></p>

<h2 id="list-of-scripts">List of scripts</h2>

<ol>
  <li><a href="#code-block-1">Ion-molecule reaction rates calculator</a></li>
  <li><a href="#code-block-2">Ion-molecule collision cross section calculator</a></li>
  <li><a href="#code-block-3">Electron impactor cross section calculator</a></li>
</ol>

<h2 id="code-block-1">Ion-molecule reaction rates calculator</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/bash</span>
<span class="nb">echo </span>please give the reagent ion mass <span class="k">in </span>amu
<span class="nb">read </span>amu
<span class="nb">echo </span>please give the temperature <span class="k">in </span>Kelvin
<span class="nb">read </span>Temp
<span class="c">#echo $rmass,$T</span>
<span class="nb">echo </span>species,reduced mass,alpha,ud,ud/sqrtalpha,C,k
<span class="k">for </span>file <span class="k">in</span> <span class="k">*</span>.log<span class="p">;</span> <span class="k">do
</span><span class="nv">filename</span><span class="o">=</span><span class="k">${</span><span class="nv">file</span><span class="p">%.log</span><span class="k">}</span>
<span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$filename</span><span class="s2">"</span>
<span class="k">if </span><span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"exited gracefully"</span> <span class="nv">$file</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">true
</span><span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"	the Gamess job does not terminate normally, restart neccesarry"</span>
    <span class="k">continue
fi
</span><span class="nb">awk</span> <span class="nt">-v</span> <span class="nv">rmass</span><span class="o">=</span><span class="s2">"</span><span class="nv">$amu</span><span class="s2">"</span> <span class="nt">-v</span> <span class="nv">T</span><span class="o">=</span><span class="s2">"</span><span class="nv">$Temp</span><span class="s2">"</span> <span class="s1">'/ALPHA\(1,1\)/ {alpha11=$3}
				  /ALPHA\(2,2\)/ {alpha22=$3}
			          /ALPHA\(3,3\)/ {alpha33=$3}
		      	          /\/D\// {getline;dipole=$4}
				  /\$DATA/ {getline;getline;getline;
					    mass=0;
					    while($3 != "$END") {
					    	if($3 == 6) mass += 12.0;
					        if($3 == 1) mass += 1.0;
						if($3 == 8) mass += 16.0;
						if($3 == 7) mass += 14.0;
						if($3 == 16) mass += 32.0;
						if($3 == 17) mass += 35.0;
						if($3 == 15) mass += 31.0;
						if($3 == 11) mass += 23.0;
						if($3 == 19) mass += 39.0;
						getline;
	 				    }
					   }
END {
     u = rmass * mass / (rmass + mass)
     alpha=(alpha11+alpha22+alpha33)/3.0
     alpha=alpha*0.529117**3
     case=dipole/sqrt(alpha)
     if(case&lt;0.082)
     C=0.0
     else
     { if( case&lt;0.163)
       C=0.02
       else
       {if (case&lt;0.250)
         C=0.045
        else
         {if (case&lt;0.327)
          C=0.084
          else
           {if(case&lt;0.408)
            C=0.115
            else
            { if(case&lt;0.490)
              C=0.137
              else
              { if(case&lt;0.572)
                C=0.156
                else
                 {if(case&lt;0.653)
                  C=0.172
                  else
                   {if(case&lt;0.735)
                    C=0.185
                    else
                     if(case&lt;0.817)
                      C=0.196
                      else
                       {if(case&lt;0.898)
                         C=0.205
                        else
                         { if(case&lt;0.980)
                          C=0.213
                           else
                           {if(case&lt;1.061)
                            C=0.220
                            else
                             {if(case&lt;1.143)
                            C=0.226
                              else
                            C=0.231
                             }
                           }
                         }
                        }
                       }
                     }
              }
             }
           }
          }
         }
        }
q=1.602176487E-19*0.1*29979245800
pi=3.14159
k=2*pi*q/sqrt(u/6.0221415E23)*(sqrt(alpha*1E-24)+C*dipole*1E-18*sqrt(2/(pi*1.3806503E-16*T)))/(1E-9)
printf("%12.6f%12.6f%12.6f%12.6f%12.6f%12.2f\n",u,alpha,dipole,dipole/sqrt(alpha),C,k)}'</span> <span class="nv">$file</span>
<span class="k">done</span>
<span class="c">#k is in unit of 1E-9 cm3/(moleclue*sec)</span>
</code></pre></div></div>

<h2 id="code-block-2">Bash script for generating *.xyz file for mobcal to calculate ion-molecule collision cross section</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/bash</span>
<span class="k">if </span><span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"EQUILIBRIUM GEOMETRY LOCATED"</span> <span class="nv">$1</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">true
</span><span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"the Gamess job type must be optimization"</span>
    <span class="nb">exit
</span><span class="k">fi
if </span><span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"TOTAL MULLIKEN AND LOWDIN ATOMIC POPULATIONS"</span> <span class="nv">$1</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">true
</span><span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"the Gamess job does not have Mulliken and lowdin population analysis"</span>
    <span class="nb">exit
</span><span class="k">fi
</span><span class="nv">fullfilename</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">filename</span><span class="o">=</span><span class="k">${</span><span class="nv">fullfilename</span><span class="p">%.log</span><span class="k">}</span>
<span class="nv">filename</span><span class="o">=</span><span class="k">${</span><span class="nv">filename</span><span class="p">##*/</span><span class="k">}</span>
<span class="nb">echo</span> <span class="nv">$filename</span>
<span class="nb">echo </span>1
<span class="nb">awk</span> <span class="s1">' 
    BEGIN{ }
    /EQUILIBRIUM GEOMETRY LOCATED/ {
	do {
	   getline var;
        } while(substr(var,17,3) != "ALL");
	getline;getline;
	i = 0;
	ntot = 0;
	do {
	   getline var;
	   if (var != "") {
	       S[i] = substr(var,0,2);
	       X[i] = substr(var,17,16);
	       Y[i] = substr(var,33,16);
	       Z[i] = substr(var,49,16);
	       i += 1;
	       ntot += 1;
	   }
	} while(var != "");
    }
    /TOTAL MULLIKEN AND LOWDIN ATOMIC POPULATIONS/ {
        getline;
        i = 0;
	do {
	   getline var;
	   if (var != "") {
		Q[i] = substr(var,58,13);
		i += 1;
	   }
	} while(var != "");
    }
    END {
	print ntot;
	print "ang";
	print "calc"
	print "1.0000"
	for(i = 0; i &lt; ntot; i += 1) {
	    if(S[i] == " H") print X[i], Y[i], Z[i],"    ", 1.0, Q[i];
	    else if (S[i] == " C") print X[i], Y[i], Z[i],"   ", 12.0, Q[i];
	    else if (S[i] == " O") print X[i], Y[i], Z[i],"   ", 16.0, Q[i];
	    else if (S[i] == " N") print X[i], Y[i], Z[i],"   ", 14.0, Q[i];
	}
 }
'</span> <span class="nv">$1</span> 
</code></pre></div></div>

<h2 id="code-block-3">Python script for calculating electron impact ionization cross sections</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#! /usr/bin/python
# a python script to parse the gamess output
# 1. Read 1 electron Kinetic Energy Integral
# 2. Read occupied MO coefficients and MO energies
# 3. Calculate the 1 electron kinetic energy of MO
</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="c1"># total number of cartesian gaussian basis functions pattern
</span><span class="n">pattern1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">"NUMBER OF CARTESIAN GAUSSIAN BASIS FUNCTIONS</span><span class="err">\</span><span class="s">s+=</span><span class="err">\</span><span class="s">s+(</span><span class="err">\</span><span class="s">d+)"</span><span class="p">)</span>
<span class="c1"># total number of electrons pattern
</span><span class="n">pattern2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">"NUMBER OF ELECTRONS</span><span class="err">\</span><span class="s">s+=</span><span class="err">\</span><span class="s">s+(</span><span class="err">\</span><span class="s">d+)"</span><span class="p">)</span>
<span class="c1"># kinetic energy integrals pattern
</span><span class="n">pattern3</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">"</span><span class="err">\</span><span class="s">s+KINETIC ENERGY INTEGRALS</span><span class="err">\</span><span class="s">s+"</span><span class="p">)</span>
<span class="c1"># MO coefficients and energies pattern
</span><span class="n">pattern4</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">"</span><span class="err">\</span><span class="s">s+EIGENVECTORS</span><span class="err">\</span><span class="s">s+"</span><span class="p">)</span>
<span class="n">NFUNC</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">NELEC</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1">#replace with your gamess result file name
</span><span class="n">fileName</span> <span class="o">=</span> <span class="s">"CS.log"</span>
<span class="c1">###################
</span><span class="n">filein</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">'r+'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filein</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pattern1</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
      <span class="n">NFUNC</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">"Gamess Execution Error"</span>

<span class="n">filein</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">'r+'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filein</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pattern2</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
      <span class="n">NELEC</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">"Gamess Execution Error"</span>

<span class="n">NFUNC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">NFUNC</span><span class="p">)</span>
<span class="n">NELEC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">NELEC</span><span class="p">)</span>

<span class="n">K_matrix</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NFUNC</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NFUNC</span><span class="p">)]</span>

<span class="n">filein</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">'r+'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filein</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pattern3</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">match</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">"Gamess Execution Error, missing 1 electron kinetic energy integrals"</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">filein</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
      <span class="n">filein</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
      <span class="n">filein</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
      <span class="n">nblock</span> <span class="o">=</span> <span class="p">(</span><span class="n">NFUNC</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span> 
      <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="n">iblock</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nblock</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">iblock</span>
        <span class="c1">#print iblock, row, NFUNC
</span>        <span class="k">for</span> <span class="n">row_index</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">NFUNC</span><span class="p">):</span>
          <span class="n">line</span> <span class="o">=</span> <span class="n">filein</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
          <span class="k">if</span> <span class="n">row_index</span> <span class="o">==</span> <span class="n">row</span><span class="p">:</span>
            <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
          <span class="k">elif</span> <span class="n">row_index</span> <span class="o">==</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
	    <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
	    <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])</span>
          <span class="k">elif</span> <span class="n">row_index</span> <span class="o">==</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
	    <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])</span>
	    <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">6</span><span class="p">])</span>
          <span class="k">elif</span> <span class="n">row_index</span> <span class="o">==</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">3</span><span class="p">:</span>
	    <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])</span>
            <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">6</span><span class="p">])</span>
	    <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">7</span><span class="p">])</span>
          <span class="k">else</span><span class="p">:</span>
	    <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])</span>
            <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">6</span><span class="p">])</span>	
	    <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">7</span><span class="p">])</span>
            <span class="n">K_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">row</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">8</span><span class="p">])</span>
        <span class="n">filein</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
        <span class="n">filein</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
        <span class="n">filein</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>

<span class="c1">#print K_matrix
# Symmetrize K_matrix
</span><span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">K_matrix</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">K_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">K_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">K_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

<span class="n">K_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">K_matrix</span><span class="p">)</span>
<span class="c1">#print K_matrix
# allocate memergy for MO coefficients
</span><span class="n">C_matrix</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NFUNC</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NFUNC</span><span class="p">)]</span>
<span class="c1"># allocate memergy for MO energies
</span><span class="n">E_Vector</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NFUNC</span><span class="p">)]</span>

<span class="n">filein</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">'r+'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filein</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pattern4</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">match</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">"Gamess Execution Error missing MO coefficients and energies, possibly SCF does not Converge"</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">filein</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
      <span class="n">nblock</span> <span class="o">=</span> <span class="p">(</span><span class="n">NFUNC</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="n">iblock</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nblock</span><span class="p">):</span>
        <span class="n">filein</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
        <span class="n">filein</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">filein</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
	<span class="n">col</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">iblock</span>
	<span class="k">if</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="n">NFUNC</span><span class="p">:</span>
          <span class="n">E_Vector</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
	<span class="k">if</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">NFUNC</span><span class="p">:</span>
	  <span class="n">E_Vector</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
	<span class="k">if</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="n">NFUNC</span><span class="p">:</span>
	  <span class="n">E_Vector</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
	<span class="k">if</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">&lt;</span> <span class="n">NFUNC</span><span class="p">:</span>
	  <span class="n">E_Vector</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span>
	<span class="k">if</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">&lt;</span> <span class="n">NFUNC</span><span class="p">:</span>
	  <span class="n">E_Vector</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span>
	<span class="n">filein</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">row_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NFUNC</span><span class="p">):</span>
	  <span class="n">line</span> <span class="o">=</span> <span class="n">filein</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
<span class="c1">#	  print line.split()
</span>          <span class="k">if</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="n">NFUNC</span><span class="p">:</span>
	    <span class="n">C_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
	  <span class="k">if</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">NFUNC</span><span class="p">:</span>
            <span class="n">C_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])</span>
	  <span class="k">if</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="n">NFUNC</span><span class="p">:</span>
	    <span class="n">C_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">col</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">6</span><span class="p">])</span>
	  <span class="k">if</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">&lt;</span> <span class="n">NFUNC</span><span class="p">:</span>
	    <span class="n">C_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">col</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">7</span><span class="p">])</span>
	  <span class="k">if</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">&lt;</span> <span class="n">NFUNC</span><span class="p">:</span>
	    <span class="n">C_matrix</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">col</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">8</span><span class="p">])</span>

<span class="c1">#print E_Vector
</span><span class="n">C_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">C_matrix</span><span class="p">)</span>
<span class="c1">#print C_matrix
</span><span class="n">C_Transpose</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">C_matrix</span><span class="p">)</span>
<span class="n">K_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C_Transpose</span><span class="p">,</span> <span class="n">K_matrix</span><span class="p">),</span> <span class="n">C_matrix</span><span class="p">)</span>

<span class="n">E_hartree</span> <span class="o">=</span> <span class="mf">27.211396132</span> <span class="c1"># Hartree to eV
</span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">E_Vector</span><span class="p">)</span>

<span class="c1">#print K_matrix
#print C_matrix
#print E_Vector
</span>
<span class="n">Tk_array</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>           			<span class="c1">#kinetic Energy of impact electron
</span><span class="n">pi</span> <span class="o">=</span> <span class="mf">3.14159265958</span>
<span class="n">a0</span> <span class="o">=</span> <span class="mf">0.5292</span> <span class="c1"># Angstrom Bohr radius
</span><span class="n">R</span> <span class="o">=</span> <span class="mf">13.61</span> <span class="c1">#eV half hartree
</span>
<span class="k">for</span> <span class="n">Tk</span> <span class="ow">in</span> <span class="n">Tk_array</span><span class="p">:</span>
  <span class="n">sigma_tot</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># total electron impact cross section
</span>
  <span class="k">if</span> <span class="n">NELEC</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># number of electrons is even. Most probably RHF.
</span>    <span class="n">norb</span> <span class="o">=</span> <span class="n">NELEC</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">norb</span> <span class="o">&gt;</span> <span class="n">NFUNC</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">"Error in Gamess SCF calculation"</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">norb</span><span class="p">):</span>
      <span class="n">Neorb</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># electrons in single molecular orbital
</span>      <span class="n">Uk</span> <span class="o">=</span> <span class="n">K_temp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">E_hartree</span>
      <span class="n">Bind</span> <span class="o">=</span> <span class="o">-</span><span class="n">E_Vector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">E_hartree</span>
      <span class="k">if</span> <span class="n">Tk</span> <span class="o">&gt;</span> <span class="n">Bind</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Tk</span> <span class="o">/</span> <span class="n">Bind</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">Uk</span> <span class="o">/</span> <span class="n">Bind</span>
        <span class="n">S</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">Neorb</span> <span class="o">*</span> <span class="n">R</span> <span class="o">*</span> <span class="n">R</span> <span class="o">/</span> <span class="n">Bind</span> <span class="o">/</span> <span class="n">Bind</span>
        <span class="n">sigma_beb</span> <span class="o">=</span> <span class="n">S</span> <span class="o">/</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">u</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">t</span> <span class="o">/</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">t</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">sigma_beb</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">sigma_tot</span> <span class="o">+=</span> <span class="n">sigma_beb</span>

  <span class="k">print</span> <span class="n">Tk</span><span class="p">,</span> <span class="n">sigma_tot</span>
</code></pre></div></div>

		  </div>
      <div class="container">
  <footer>
    <p class="text-muted credit">
      &copy; 2019 Based on Herring Cove &middot; Build with
      	<a href="https://jekyllrb.com"> Jekyll </a>
      	2019-06-04 09:45:00 -0400
    </p>
  </footer>
</div>
    </div>
	</div>
  </body>
</html>